<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FDU Wordle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #guessInput {
            width: 60px;
            text-transform: uppercase;
        }
        .result {
            margin-top: 10px;
        }
        .GRAY { color: gray; }
        .YELLOW { color: goldenrod; }
        .GREEN { color: green; }
    </style>
</head>
<body>
<center>
<h1>Welcome to FDU Wordle!</h1>
<p>Enter your 5-letter guess:</p>
    <form onsubmit="sendGuess(); return false;">
        <input id="guessInput" maxlength="5">
        <button type = "submit">Guess</button>
        <button type = "button" onclick="resetGame()">ResetGame</button>
    </form>
<p></p>
<div id="messages"></div>
<p></p>
<div id="results"></div>
</center>


<script>
    async function resetGame() {
        await fetch(`/api/wordle/reset`, { method: 'POST' });
        clearGameDisplay();
        setGameControls(true);
    }
    async function sendGuess() {
        const guess = document.getElementById("guessInput").value.trim();
        if (!guess) return;

        const response = await fetch(`/api/wordle/guess?guess=${guess}`, { method: 'POST' });
        const data = await response.json();
        clearMessages();           // clear prior message

        // Display guess result
        const resultsDiv = document.getElementById("results");
        const guessEval = data.guessResult.guessEval || [];
        const row = guessEval.map((res, i) => `<span class="${res}">${guess[i].toUpperCase()}</span>`).join(' ');
        const div = document.createElement('div');
        div.className = "result";
        div.innerHTML = row;
        resultsDiv.appendChild(div);
        clearGuessInput();   // clear the button contents & refocus for next input

        // Display game status messages
        const messagesDiv = document.getElementById("messages");
        if (data.guessResult.guessStatus == "INVALID") {
            messagesDiv.innerHTML = "<strong>ERROR! Words must contain alphas only</strong>";
        } else if (data.gameStatus.userWon) {
            messagesDiv.innerHTML = "<strong>Congratulations! You guessed the word!</strong>";
            setGameControls(false);
        } else if (data.gameStatus.gameOver) {
            messagesDiv.innerHTML = `<strong>Game Over! The word was ${data.gameStatus.secretWord}</strong>`;
            setGameControls(false);
        }
    }  // end sendGuess

    // a little permuted, object flag is disabled, but for clarity using true to mean enable game controls
    function setGameControls(enabled) {
        document.querySelector("button[type='submit']").disabled = !enabled;
        document.getElementById("guessInput").disabled = !enabled;
    }

    // clear entire display, or individual helper functions to clear a display element
    function clearGameDisplay() {
        clearGuessInput();
        clearMessages();
        clearResults();
    }

    function clearGuessInput() {
        const input = document.getElementById("guessInput");
        input.value = "";
        input.focus();
    }

    function clearMessages() {
        document.getElementById("messages").innerHTML = "";
    }

    function clearResults() {
        document.getElementById("results").innerHTML = "";
    }
</script>
</body>
</html>