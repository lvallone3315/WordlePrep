<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FDU Wordle</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <style>
        /* Full page flex centering */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }

        /* Game container */
        .game-container {
            width: 90%;
            max-width: 360px;
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        form {
            display: flex;
            flex-direction: column; /* stack input + buttons vertically on phones */
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }
        #guessInput {
            width: 70%;
            max-width: 120px;
            font-size: 1rem;
            text-transform: uppercase;
            padding: 6px;
            text-align: center;
        }
        button {
            padding: 6px 12px;
            font-size: 1rem;
            margin: 2px;
            cursor: pointer;
        }
        /* Container for each guess row */
        .result {
            margin-top: 8px;
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        /* Each letter tile */
        .result span {
            width: 48px;
            height: 48px;
            line-height: 48px;
            text-align: center;

            font-size: 1.8rem;
            font-weight: 800;

            border: 2px solid #ccc;
            border-radius: 6px;

            display: inline-block;
            font-family: sans-serif;
        }
        /* Letter colors */
        .GRAY { color: gray; }
        .YELLOW { color: goldenrod; }
        .GREEN { color: green; }
        /* Messages styling */
        #messages {
            margin-top: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="game-container">
<h1>Welcome to FDU Wordle!</h1>
<p id="app-version" style="font-size: 0.8em; color: #666; margin-top: -10px;">
    version: loading...
</p>
<p>Enter your 5-letter guess:</p>
    <form onsubmit="sendGuess(); return false;">
        <input id="guessInput" maxlength="5" autofocus>
        <button type = "submit">Guess</button>
        <button type = "button" onclick="resetGame()">ResetGame</button>
    </form>
<div id="messages"></div>
<div id="results"></div>
</div>
</body>
</html>

<script>
    async function resetGame() {
        await fetch(`/api/wordle/reset`, { method: 'POST' });
        clearGameDisplay();
        setGameControls(true);
    }

    async function getGameStatus() {
        try {
            const response = await fetch(`/api/wordle/status`, { method: 'GET' });
            const data = await response.json();
                // Find the version element and update it with the value from gameStatus
            if (data.gameVersion) {
                document.getElementById('app-version').innerText = "version: " + data.gameVersion;
            }
        } catch (err) {
            document.getElementById('app-version').innerText = "version: offline";
        }
    }

    async function sendGuess() {
        const guess = document.getElementById("guessInput").value.trim();
        if (!guess) return;

        const response = await fetch(`/api/wordle/guess?guess=${guess}`, { method: 'POST' });
        const data = await response.json();
        clearMessages();           // clear prior message

        // Display guess result
        const resultsDiv = document.getElementById("results");
        const guessEval = data.guessResult.guessEval || [];
        const row = guessEval.map((res, i) => `<span class="${res}">${guess[i].toUpperCase()}</span>`).join(' ');
        const div = document.createElement('div');
        div.className = "result";
        div.innerHTML = row;
        resultsDiv.appendChild(div);
        clearGuessInput();   // clear the button contents & refocus for next input

        // Display game status messages
        const messagesDiv = document.getElementById("messages");
        if (data.guessResult.guessStatus == "INVALID") {
            messagesDiv.innerHTML = "<strong>ERROR! Words must contain alphas only</strong>";
        } else if (data.gameStatus.userWon) {
            messagesDiv.innerHTML = "<strong>Congratulations! You guessed the word!</strong>";
            setGameControls(false);
        } else if (data.gameStatus.gameOver) {
            messagesDiv.innerHTML = `<strong>Game Over! The word was ${data.gameStatus.secretWord}</strong>`;
            setGameControls(false);
        }
    }  // end sendGuess

    // a little permuted, object flag is disabled, but for clarity using true to mean enable game controls
    function setGameControls(enabled) {
        document.querySelector("button[type='submit']").disabled = !enabled;
        document.getElementById("guessInput").disabled = !enabled;
    }

    // clear entire display, or individual helper functions to clear a display element
    function clearGameDisplay() {
        clearGuessInput();
        clearMessages();
        clearResults();
    }

    function clearGuessInput() {
        const input = document.getElementById("guessInput");
        input.value = "";
        input.focus();
    }

    function clearMessages() {
        document.getElementById("messages").innerHTML = "";
    }

    function clearResults() {
        document.getElementById("results").innerHTML = "";
    }
</script>
<script>
    window.onload = async () => {
        await resetGame();
        await getGameStatus();
    };
</script>

</body>
</html>